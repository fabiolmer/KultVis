<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Leaflet Map - Gothenburg Cultural Activities</title>
    
    <script src="https://unpkg.com/shpjs@latest/dist/shp.js"></script>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/leaflet@1.9.4/dist/leaflet.css" />
    <script src="https://cdn.jsdelivr.net/npm/leaflet@1.9.4/dist/leaflet.js"></script>

    <style>
        body, html { margin: 0; padding: 0; height: 100%; }
        #map { height: 100vh; width: 100vw; background: #ddd; }

        /* Widgets */
        #heading-widget {
            position: absolute; top: 20px; right: 20px;
            padding: 12px 20px; background: rgba(255, 255, 255, 0.9);
            border: 0.4px solid #333; border-radius: 5px;
            z-index: 1000; font-family: sans-serif;
            box-shadow: 0 2px 5px rgba(0,0,0,0.3); pointer-events: none;
        }

        #activity-widget {
            position: absolute; top: 80px; right: 20px;
            z-index: 1000; width: 400px;
            display: flex; flex-direction: column; padding: 15px;
            background: rgba(255, 255, 255, 0.9); border: 0.4px solid #333;
            border-radius: 5px; font-family: sans-serif;
            box-shadow: 0 2px 5px rgba(0,0,0,0.3);
        }

        #widget-text { padding-bottom: 10px; font-weight: bold; }
        #widget-img { width: 100%; height: auto; border-radius: 4px; }
    </style>
</head>
<body>

    <div id="map"></div>
    <div id="heading-widget">Gothenburg Film Studios</div>
    <div id="activity-widget">
        <div id="widget-text">Activities</div>
        <img id="widget-img" src="activities_bar_graph.png" alt="activities bar graph">
    </div>

    <script>
        console.log("Script starting...");
        
        // 1. Initialize Map
        var map = L.map('map').setView([57.70979, 11.93344], 16);

        L.tileLayer('https://{s}.basemaps.cartocdn.com/light_all/{z}/{x}/{y}{r}.png', {
            attribution: '&copy; OpenStreetMap'
        }).addTo(map);

        // 2. Define Colors
        const categoryColors = {
            "Museum": "#e74c3c", "Bibliotek": "#3498db", "Atelj√©": "#9b59b6", 
            "Biograf": "#f1c40f", "Kulturhus": "#2ecc71", "default": "#95a5a6" 
        };

        // 3. Draw Campus Buildings
        var campusData = [
            { name: "Studios building", points: [[57.70951, 11.93193], [57.71001, 11.93243], [57.70951, 11.93193]] },
            { name: "Rehearsal building", points: [[57.70928, 11.93220], [57.70939, 11.93250], [57.70928, 11.93220]] }
        ];

        campusData.forEach(function(building) {
            var poly = L.polygon(building.points, { color: 'red', weight: 2, fillOpacity: 0.2 }).addTo(map);
            poly.bindPopup(building.name);
        });

        // 4. Load Shapefile
        async function loadCulturalData() {
            try {
                // Ensure this file is in the SAME folder as your index.html
                const geojsonData = await shp("kulturverksamheter_utdrag_GBG_251212.zip");
                
                L.geoJSON(geojsonData, {
                    pointToLayer: function (feature, latlng) {
                        const category = feature.properties.Kategori || feature.properties.Typ; 
                        const color = categoryColors[category] || categoryColors["default"];
                        return L.circleMarker(latlng, {
                            radius: 8,
                            fillColor: color,
                            color: "#fff",
                            weight: 2,
                            fillOpacity: 0.9
                        });
                    },
                    onEachFeature: function(feature, layer) {
                        layer.bindPopup("<strong>" + (feature.properties.Namn || "Cultural Site") + "</strong>");
                    }
                }).addTo(map);
                console.log("Shapefile loaded!");
            } catch (err) {
                console.error("Shapefile Error:", err);
            }
        }

        loadCulturalData();
    </script>
</body>
</html>
